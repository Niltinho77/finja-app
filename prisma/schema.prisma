generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id              String        @id @default(cuid())
  nome            String?
  telefone        String        @unique
  idioma          String?       @default("pt-BR")
  ativo           Boolean       @default(true)
  criadoEm        DateTime      @default(now())
  atualizadoEm    DateTime      @updatedAt
  plano           String?       @default("free")
  trialExpiraEm   DateTime?
  premiumExpiraEm DateTime?
  tester          Boolean       @default(false)
  interacoesIA    InteracaoIA[]
  tarefas         Tarefa[]
  transacoes      Transacao[]
}

model Categoria {
  id         String        @id @default(cuid())
  nome       String        @unique
  tipo       TipoTransacao
  icone      String?
  cor        String?
  descricao  String?
  criadoEm   DateTime      @default(now())
  transacoes Transacao[]
}

model Transacao {
  id           String        @id @default(cuid())
  usuarioId    String
  descricao    String
  valor        Float
  tipo         TipoTransacao
  data         DateTime      @default(now())
  categoriaId  String?
  origemTexto  String?
  confirmado   Boolean       @default(false)
  criadoEm     DateTime      @default(now())
  atualizadoEm DateTime      @updatedAt
  categoria    Categoria?    @relation(fields: [categoriaId], references: [id])
  usuario      Usuario       @relation(fields: [usuarioId], references: [id])
}

model Tarefa {
  id              String       @id @default(cuid())
  usuarioId       String
  descricao       String
  data            DateTime?
  hora            String?
  status          StatusTarefa @default(PENDENTE)
  origemTexto     String?
  lembrarEm       DateTime?
  lembreteEnviado Boolean      @default(false)
  criadoEm        DateTime     @default(now())
  atualizadoEm    DateTime     @updatedAt
  usuario         Usuario      @relation(fields: [usuarioId], references: [id])
}

model InteracaoIA {
  id           String          @id @default(cuid())
  usuarioId    String
  entradaTexto String
  respostaIA   String?
  tipo         TipoInteracaoIA
  sucesso      Boolean         @default(true)
  messageId    String?         @unique
  criadoEm     DateTime        @default(now())
  usuario      Usuario         @relation(fields: [usuarioId], references: [id])
}

enum TipoTransacao {
  ENTRADA
  SAIDA
}

enum StatusTarefa {
  PENDENTE
  CONCLUIDA
  CANCELADA
}

enum TipoInteracaoIA {
  TRANSACAO
  TAREFA
  CONSULTA
  EDICAO
  REMOCAO
  OUTRO
}
