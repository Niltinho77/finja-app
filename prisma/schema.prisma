generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Usuario {
  id             String          @id @default(cuid())
  nome           String?
  telefone       String          @unique
  idioma         String?         @default("pt-BR")
  ativo          Boolean         @default(true)
  criadoEm       DateTime        @default(now())
  atualizadoEm   DateTime        @updatedAt

  transacoes     Transacao[]
  tarefas        Tarefa[]
  interacoesIA   InteracaoIA[]
  
  plano          String?         @default("free")  // free | trial | premium | tester | blocked
  trialExpiraEm  DateTime?
  premiumExpiraEm DateTime?
  tester         Boolean         @default(false)   // true = acesso liberado independente de plano
}

model Categoria {
  id            String         @id @default(cuid())
  nome          String         @unique
  tipo          TipoTransacao  // ENTRADA ou SAIDA
  icone         String?        // ex: "ðŸ’³" ou "ðŸ›’"
  cor           String?        // ex: "#FF9800"
  descricao     String?
  transacoes    Transacao[]
  criadoEm      DateTime       @default(now())
}

model Transacao {
  id             String          @id @default(cuid())
  usuario        Usuario         @relation(fields: [usuarioId], references: [id])
  usuarioId      String

  descricao      String
  valor          Float
  tipo           TipoTransacao
  data           DateTime        @default(now())

  categoriaId    String?
  categoria      Categoria?      @relation(fields: [categoriaId], references: [id])

  origemTexto    String?
  confirmado     Boolean         @default(false)

  criadoEm       DateTime        @default(now())
  atualizadoEm   DateTime        @updatedAt
}


enum TipoTransacao {
  ENTRADA
  SAIDA
}

model Tarefa {
  id               String          @id @default(cuid())
  usuario          Usuario         @relation(fields: [usuarioId], references: [id])
  usuarioId        String

  descricao        String
  data             DateTime?
  hora             String?
  status           StatusTarefa    @default(PENDENTE)
  origemTexto      String?
  lembrarEm        DateTime?       // data/hora para disparar lembrete
  lembreteEnviado  Boolean         @default(false)

  criadoEm         DateTime        @default(now())
  atualizadoEm     DateTime        @updatedAt
}

enum StatusTarefa {
  PENDENTE
  CONCLUIDA
  CANCELADA
}

model InteracaoIA {
  id             String      @id @default(cuid())
  usuario        Usuario     @relation(fields: [usuarioId], references: [id])
  usuarioId      String

  entradaTexto   String
  respostaIA     String?
  tipo           TipoInteracaoIA
  sucesso        Boolean     @default(true)
  messageId      String?     @unique
  criadoEm       DateTime    @default(now())
}

enum TipoInteracaoIA {
  TRANSACAO
  TAREFA
  CONSULTA
  EDICAO
  REMOCAO
}
