generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PlanoUsuario {
  TRIAL
  PREMIUM
  TESTER
  BLOQUEADO
}


model Usuario {
  id              String          @id @default(cuid())
  nome            String?
  telefone        String          @unique
  idioma          String?         @default("pt-BR")
  ativo           Boolean         @default(true)
  criadoEm        DateTime        @default(now())
  atualizadoEm    DateTime        @updatedAt

  transacoes      Transacao[]
  tarefas         Tarefa[]
  interacoesIA    InteracaoIA[]

  // ðŸ”¹ Gerenciamento de plano
  plano           PlanoUsuario?   @default(TRIAL)
  trialAtivadoEm  DateTime?       @default(now())
  stripeCustomerId       String?          
  stripeSubscriptionId   String?
  trialExpiraEm   DateTime?
  premiumExpiraEm DateTime?
  tester          Boolean         @default(false)
}


model Categoria {
  id         String        @id @default(cuid())
  nome       String        @unique
  tipo       TipoTransacao
  icone      String?
  cor        String?
  descricao  String?
  criadoEm   DateTime      @default(now())
  transacoes Transacao[]
}

model Transacao {
  id           String        @id @default(cuid())
  usuarioId    String
  descricao    String
  valor        Float
  tipo         TipoTransacao
  data         DateTime      @default(now())
  categoriaId  String?
  origemTexto  String?
  confirmado   Boolean       @default(false)
  criadoEm     DateTime      @default(now())
  atualizadoEm DateTime      @updatedAt
  categoria    Categoria?    @relation(fields: [categoriaId], references: [id])
  usuario      Usuario       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
}

model Tarefa {
  id              String       @id @default(cuid())
  usuarioId       String
  descricao       String
  data            DateTime?
  hora            String?
  status          StatusTarefa @default(PENDENTE)
  origemTexto     String?
  lembrarEm       DateTime?
  lembreteEnviado Boolean      @default(false)
  criadoEm        DateTime     @default(now())
  atualizadoEm    DateTime     @updatedAt
  usuario         Usuario      @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
}

model InteracaoIA {
  id           String          @id @default(cuid())
  usuarioId    String
  entradaTexto String
  respostaIA   String?
  tipo         TipoInteracaoIA
  sucesso      Boolean         @default(true)
  messageId    String?         @unique
  criadoEm     DateTime        @default(now())
  usuario      Usuario         @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
}

enum TipoTransacao {
  ENTRADA
  SAIDA
}

enum StatusTarefa {
  PENDENTE
  CONCLUIDA
  CANCELADA
}

enum TipoInteracaoIA {
  TRANSACAO
  TAREFA
  CONSULTA
  EDICAO
  REMOCAO
  OUTRO
  ERRO
}
